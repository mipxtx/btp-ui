function str_replace(a,b,c){return c.split(a).join(b)}function encodeparam(a){return encodeURI(a).split("/").join("*")}function decodeparam(a){return a.split("*").join("/")}function getLink(){var a,b="#",c=App.getLinkParams();for(a=0;a<arguments.length;a++){var d=arguments[a];"object"==typeof d&&~String(d).indexOf("~~")?c=_.extend(c,d):b+=encodeparam(d)+"/"}return a=0,_.each(c,function(c,d){b+=(0===a?"?":"&")+d+"="+encodeparam(c),a++}),b}function parse_names_from_path(a,b){if(_.isArray(a)||!a.branches&&!a.names_ts)return a;if(_.isArray(a.branches)){var c=_.filter(a.branches,function(a){return!/(^~~)|(\[\[EMPTY\]\])/.test(a)});return c.length!==a.branches.length&&c.unshift("[[EMPTY]]"),c}return b=b||1,_.compact(_.uniq(_.map(a.names_ts||[],function(a){return a.name.split("~~")[b]})))}function transform_list(a,b,c){var d=[],e={},f=[];App.isAPIv2&&(b=parse_names_from_path(b,1));var g=App.groupConfig[a];b=b||[];var h=_.map(g,function(a,b){return a.items=_.map(a.items,function(a){return new RegExp(a)}),a});_.each(g,function(a){e[a.title]=[]});var i,j=b.length;for(i=0;i<j;i++){var k=b[i];if(""!==k){var l,m={name:k,val:k,warning:!1,items:null};if(c&&c.length)for(l=0;l<c.length;l++)if(c[l]===m.val){m.warning=!0;break}var l,n,o=0;a:for(l=0;l<h.length;l++)if(h[l]&&h[l].items)for(n=0;n<h[l].items.length;n++)if(h[l].items[n]&&h[l].items[n].test(m.val)){o=h[l];break a}o?(o.replace&&m.name&&(m.name=m.name.split(o.replace).join("")),e[o.title].push(m)):d.push(m)}}return _.map(e,function(a,b){a.length&&(a.sort(function(a,b){var c="string"==typeof a?a.name.toLocaleLowerCase():a.name,d="string"==typeof b?b.name.toLocaleLowerCase():b.name;return c<d?-1:c>d?1:0}),f.push({name:b,items:a,warning:!!_.find(a,function(a){return m.warning})}))}),f.sort(function(a,b){var c=(a.name+"").toLocaleLowerCase(),d=(b.name+"").toLocaleLowerCase();return c<d?-1:c>d?1:0}),d.sort(function(a,b){var c=(a.name+"").toLocaleLowerCase(),d=(b.name+"").toLocaleLowerCase();return c<d?-1:c>d?1:0}),_.map(d,function(a){f.push(a)}),f}function curry(a,b){for(var c=[],d=1,e=arguments.length;d<e;d++)c.push(arguments[d]);return function(){for(var b=_.clone(c),d=0,e=arguments.length;d<e;d++)b.push(arguments[d]);return a.apply(a,b)}}function getJsonFromUrl(a){for(var b=a.split("&"),c={},d=0,e=b.length;d<e;d++){var f=b[d].split("=");c[f[0]]=f[1]}return c}function mkscale(a,b){return a.count=a.count/b,a}function xround(a,b,c){return c(a/(b||1))*b}function draw_pair(a,b,c,d,e,f){d=+d;var g={ts:0,data:{},scale:b.scale/1e6||App.getPlotScale()};if(_.each(b.data,function(a){var b=a.name.split("~~"),c=null!=f?b[f]:_.last(b),d=g.data[c]=App.getOldPlotData(a.counters,g.scale),e=App.getOldPlotTS(d);e&&(g.ts=Math.max(g.ts,e))}),!g.ts&&!g.scale)return!1;var h=new window.btpgraph(g.ts,g.scale),i=new window.btpgraph(g.ts,g.scale);_.each(g.data,function(a,b){h.addTime(a,b),i.addCount(a,b)}),h.init(a,{width:App.current_width,percSelector:!0}),i.init(a,{width:App.current_width,rateAndCountSelector:!0}),h.setPair(i),i.setPair(h)}window.btp={host:"127.0.0.1",loader:0,_loader_inc:function(){1==++this.loader&&setTimeout(function(){window.btp.loader>0&&$("#loader").modal("show")},1)},_loader_dec:function(){0===--this.loader&&$("#loader").modal("hide")},prepareParamsV2:function(a,b,c){var d={get_list:"get_name_tree",get_graph:"get",get_multigraph:"multi_get"},e="branch";c.scale=App.scale,c.method=d[a];var f="",g="",h="~~";if("service"===App._category)if(f="service",b.names&&b.service)for(var i=0;i<b.names.length;i++)b.names[i]=f+h+b.service+h+(b.server&&"?"!=b.server?b.server+h:"")+b.names[i];else"get_list"===a&&"?"===b.script&&(c.method="get_names",f="script",g=b.service+h+b.op),g||(b.service&&"?"!==b.service&&(f+=h+("[[EMPTY]]"!==b.service?b.service:"")),"get_list"!==a||b.op||""!==b.server?(b.server&&"?"!==b.server&&(f+=h+b.server),b.op&&("?"===b.op?e="leaf":f+=h+("*"===b.op?".*":b.op))):(c.method="get_names",f+=h+".*"));else if("script"===App._category){if(f="script",b.names&&b.script)for(var j=0;j<b.names.length;j++)b.names[j]=f+h+b.script+h+(b.service&&"?"!=b.service?b.service+h:"")+b.names[j];b.script&&"?"!==b.script&&(f+=h+b.script),b.service&&"?"!==b.service&&(f+=h+b.service),b.op&&("?"===b.op?e="leaf":"*"!==b.op&&(f+=h+b.op))}else"dashboard"===App._category&&(f=!0);if(!f)return!1;if("get"===c.method)c.params=JSON.stringify({name:f+(b.op&&"?"!==b.op?"":".*"),sep:h,ts:0,offset:0,limit:3e3});else if("multi_get"===c.method){if(!b.names||!b.names.length)return!1;c.params=JSON.stringify({names:_.map(b.names,function(a){return a.replace(/\[\[EMPTY\]\]/g,"")}),sep:h,ts:0,offset:0,limit:3e3,power:b.power||!1})}else"get_names"===c.method?c.params=JSON.stringify({prefix:f+h,suffix:h+g,sep:h,offset:0,limit:b.limit||1e5,sortby:null!=b.sortby?b.sortby:"count",power:b.power||!1}):"get_name_tree"===c.method?c.params=JSON.stringify({prefix:f,depth:1,sep:h,ntype:e,offset:0,limit:b.limit||1e5,sortby:null!=b.sortby?b.sortby:"count",power:b.power||!1}):(c.method=a,c.params=JSON.stringify(b));return!0},query:function(a,b,c){function d(a,b,c,d){window.btp.onError({title:"Ошибка получения данных с сервера",status:a,msg:b,reqParams:JSON.stringify(c)},d)}var e=$.Deferred();if(a){var f={cluster:window.btp.cluster};if(App.isAPIv2){if(!window.btp.prepareParamsV2(a,b,f))return e.reject();var g;if("get_list"===a&&"?"===_.property(App._category)(b)&&(g=this.getListFromCache(App._category)))return e.resolve(g),c&&c(g),e}else f.method=a,f.params=JSON.stringify(b);f.method&&(window.btp._loader_inc(),window.$.post("js.php",f,"json").done(function(g){g?!g||_.isString(g)?(d("no data","пустой ответ сервера",f,g),e.reject()):(e.resolve(g),"get_list"===a&&"?"===_.property(App._category)(b)&&window.btp.setListToCache(App._category,g)):e.reject(),c&&c(g)}).error(function(a,b,c){d(b,c,f),e.reject()}).always(function(){window.btp._loader_dec()}))}else c&&c(b),e.resolve(!1);return e.promise()},isLocalStorageAvailable:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}},clearCache:function(){if(!this.isLocalStorageAvailable())return!1;localStorage["service".concat("_",btp.getHost())]=null,localStorage["script".concat("_",btp.getHost())]=null},getListFromCache:function(a){if(!this.isLocalStorageAvailable())return!1;a=a.concat("_",btp.getHost());try{return _.now()-(+localStorage[a.concat("_timestamp")]||0)<App._cacheAlive?JSON.parse(localStorage[a]):null}catch(a){return null}},setListToCache:function(a,b){if(!this.isLocalStorageAvailable())return!1;a=a.concat("_",btp.getHost());try{return localStorage[a]=JSON.stringify(b),localStorage[a.concat("_timestamp")]=_.now(),!0}catch(a){return!1}},onError:function(a,b){var c=$("ul li a.js-errors"),d=c.find("b");d.text(+d.text()+1),c.parent().removeClass("empty"),_.isString(b)?$("#content-right").html(b):window.btp.show("alert",a).done(function(a){$(a).alert().appendTo($("#errorList .js-error-list"))})},multi_query:function(a,b){var c=new Paralleler;_.each(a,function(a){c.add_bind_obj(btp,btp.query,a)}),c.onfinish(b)},tpls:{},show:function(a,b,c){function d(){"use strict";setTimeout(function(){i.r=j.splice(0,l),g=_.template(h,i),e&&e.append(g),$(document).trigger("loader.progress",{progress:j.length/k}),j.length>0?d():($(document).trigger("loader.finished"),e?f.resolve(e):f.resolve($(g)))},20)}var e=c&&$(c),f=$.Deferred();b=b||{};var g,h=btp.tpls[a];if(h||(h=btp.tpls[a]=$("#"+a+"_tpl").html()),!h)throw a;if(b&&b.r&&_.isArray(b.r)&&b.r.length>300){var i=_.extend({},b),j=i.r.slice(0,i.r.length),k=j.length,l=150;e&&e.empty(),d()}else b.msg&&(b.msg=b.msg.replace(/(<[\s\S]*(.*?)>)/gi,"")),g=_.template(h,_.extend({title:"",status:"",msg:"",reqParams:""},b)),e?(e.html(g),f.resolve(e)):f.resolve($(g));return f.promise()},query_show:function(a,b,c,d){window.btp.query(b,c,function(b){var c=window.btp.show(a,b);d(c,b)})},parallel:new Paralleler,renderBlock:function(a,b,c){function d(a,b){for(var c=Math.min(g*h,e);f<c;f++)"function"==typeof a&&a(f);g*h<e?(g++,setTimeout(function(){d(a,b)},4)):"function"==typeof b&&b()}var e=a.length,f=0,g=1,h=100;d(b,c)},getHost:function(a){return a||window.btp.cluster+":"+App.scale}};var App=window.App||{};App.loading=!1,App.scale=5,App.current_width=800,App.PLOT_HISTORY=3e3,App.set=function(a,b){var c="active";if(window.location.hash=window.location.hash.replace(/(%3C([^]+)%3E)/gi,""),"Scale"===b){if(App.scale!==+a&&window.location.hash.indexOf("scale="+App.scale)>=0){var d=window.location.hash.replace("scale="+App.scale,"scale="+a);window.location.hash=d,App.Updaters.left_empty(),App.Updaters.right_empty()}App.scale=+a}if("HostGroup"===b){var e=a||App.hostConfig.cluster.default;window.location.hash.indexOf("cluster="+window.btp.cluster)>=0&&(window.location.hash=window.location.hash.replace("cluster="+window.btp.cluster,"cluster="+e),App.Updaters.left_empty(),App.Updaters.right_empty()),window.btp.cluster=e}"Graph"===b&&(App.newGraph="flot"===a,btp.isLocalStorageAvailable()&&(localStorage.Graph=a)),App.saveCookie(),App.isAPIv2=!0;var f=$(".js-selector").filter('[data-type="'+b+'"]');"HostGroup"===b&&$(".js-selector").filter("[data-type=Scale]").find("li a").each(function(){var a=$(this),b=a.data("value");~~App.hostConfig.scale.types.indexOf(b)?a.show():a.hide()}),f.find("li."+c).removeClass(c);var g=f.find('a[data-value="'+("Scale"==b?App.scale:"HostGroup"==b?window.btp.cluster:"Graph"==b?a:"")+'"]');g.parent().addClass(c),f.find("a.dropdown-toggle span").text(g.text())},App.saveCookie=function(){document.cookie="JCB{cluster="+window.btp.cluster+"&scale="+App.scale+"}JCE"},App.getLinkParams=function(){return{cluster:window.btp.cluster,scale:App.scale}},App._parse_url_hlp=function(a){var b=(a||"").split("?"),c=_.map(b[0].split("/"),decodeparam);return{args:getJsonFromUrl(b[1]||""),path:c,length:c.length-1}},App.parse_url=function(a){var b=App._parse_url_hlp(a||"");return b.args.scale&&App.set(b.args.scale,"Scale"),b.args.cluster&&App.set(b.args.cluster,"HostGroup"),b},App._registerPlot=function(a){App._plots||(App._plots={},$(window).on("resize",_.throttle(function(){App.applyOnPlots("doResize")},250))),App._plots[a.pType]&&(App._plots[a.pType].destroy(),delete App._plots[a.pType]),App._plots[a.pType]=a.plot},App.applyOnPlots=function(a){var b,c,d=App._plots,e=[].slice.call(arguments,1);for(c in d)if(d.hasOwnProperty(c)){b=d[c];try{b[a]&&b[a].apply(b,e)}catch(a){delete d[c]}}},App._createPlot=function(a){function b(){for(var b,c,d,e,f=[],h=!1,i=a.data,j={},k=a.filter,l=0;l<i.length;l++)b=i[l],d=b.id||b.label,e=b.label||b.id,1===a.pType&&"count"===e&&(d=e="rate"),k||(c=a.$el.find("#id"+d)),(k?e in k:!1!==a.addLegend&&!c.prop("checked")&&(c.get(0)||b.skip))?(f.push(_.extend({},b,{data:[],skip:!0})),c&&c.parent().addClass("unchecked"),j[b.label||b.id]=null):(delete b.skip,1===a.pType?("count"!==b.label&&"rate"!==b.label||a.currentType===b.label)&&f.push(_.extend({},b,{data:b.data})):a.currentType&&f.push(_.extend({},b,{data:b.data[a.currentType]})),c&&c.parent().removeClass("unchecked"),h=!0);return 3===a.pType&&App.applyOnPlots("plotAccordingToChoices",j),g(h),f}function c(c){c&&(a.filter=c),i.setData(b()),e(),i.setupGrid(),i.draw(),i.clearCrosshair()}function d(a,b){var c=!1,d=1e3*App.getPlotScale();$.each(i.getXAxes(),function(a,e){var f=e.options;b?Math.floor(b.xaxis.to)-Math.floor(b.xaxis.from)>d&&(f.min=b.xaxis.from,f.max=b.xaxis.to,c=!0):(f.min=Date.now()-1e3*App.getPlotScale()*App.PLOT_HISTORY,f.max=Date.now(),c=!0)}),c&&(e(),i.setupGrid(),i.draw(),(!a.isTrigger||a.isTrigger>2)&&i.getPlaceholder().triggerHandler("zoomed",b)),i.clearSelection(),i.clearCrosshair()}function e(){var a=i.getData(),b=i.getXAxes()[0].options;$.each(i.getYAxes(),function(c,d){var e=d.options;e.max=e.min=0,$.each(a,function(a,c){if(d.n===c.yaxis.n&&!c.skip)for(var f,g=0;g<c.data.length;g++)if(f=c.data[g],!(f[0]<b.min)){if(f[0]>b.max)break;e.max=Math.max(f[1],e.max||0)}}),e.max+=e.max/100*5})}function f(b,c,d){var e=i.getAxes();if(!(!c||c.x<e.xaxis.min||c.x>e.xaxis.max)){var f,g,h=0,j=i.getData(),k=function(a){Math.abs(c.x-a)<Math.abs(c.x-h)&&(h=a)};for(f=0;f<j.length;++f){var l,m,n,o,p=j[f],q=0,r=0;for(g=0;g<p.data.length;++g)if(null!==(n=p.data[g])){if(m=g+1,null===p.data[m]&&(m=g+2),(o=p.data[m])&&n[0]<c.x&&c.x<o[0]){q=c.x-n[0],r=o[0]-c.x,l=q<r?g:m,p.data[l][1],k(p.data[l][0]);break}if(!o||c.x<n[0]){n[1],k(n[0]);break}}}i.lockCrosshair({x:h});var s,t=a.$el.find(".plotpopupX"),u=50;h?(s=i.p2c({x:h}),t.addClass("filled").html($.plot.formatDate(new Date(h),"%d.%m.%Y %H:%M:%S")).css({top:i.getPlaceholder().height()-t.height()-5,left:Math.max(Math.min(s.left+u-t.width()/2,a.$el.width()-t.width()-30),15)})):t.removeClass("filled");var v=a.$el.find(".plotpopupY");d?(s=i.offset(),v.addClass("filled").find("b").css({"background-color":d.series.color}).end().find("span").html(d.series.label+" = "+d.datapoint[1]).end().css({top:d.pageY-s.top-v.height(),left:Math.min(d.pageX-s.left+u,a.$el.width()-v.width()-30)})):v.removeClass("filled")}}function g(b){$(a.$el.find(".js-toggle-checked")).find("b").text(b?"Скрыть все":"Показать все").end().find("span").removeClass().addClass(b?"icon-eye-close":"icon-eye-open")}function h(){var b=a.$el.find(".plotlegend label:not(.unchecked)").length>0;a.$el.find(".plotlegend input").each(function(a,c){$(c).prop("checked",!b)}),g(b),c()}var i,j=[];if(a){2===a.pType?(a.currentType="perc80",a.addLegend=!1):a.currentType="rate",j.push('<div class="plothandler">'),j.push('<div class="plotcanvas"></div>'),j.push('<div class="plotoptions">'),j.push('<div class="btn-group select-graph hide"><button class="btn btn-small dropdown-toggle" data-toggle="dropdown"><span class="value js-selected"></span><span class="caret"></span></button><ul class="dropdown-menu"></ul></div>'),j.push("</div>"),j.push('<div class="plotlegend"></div>'),j.push('<div class="plotpopup plotpopupY"><b>&nbsp;</b><span></span></div>'),j.push('<div class="plotpopup plotpopupX"></div>'),j.push("</div>"),a.$el=$(j.join("")).appendTo(a.el),i=a.plot=$.plot(a.$el.find(".plotcanvas"),b(),App.getPlotOptions(a.pType)),c(),!1!==a.addLegend&&function(){var b=a.$el.find(".plotlegend"),c=i.getData(),d=[];d.push('<div class="nav nav-pills">');for(var e,f=0;f<c.length;f++)e=c[f],d.push('<label class="legendLabel'),d.push(e.skip?' unchecked"':'"'),d.push('><span class="badge" style="background-color: '+e.color+';"></span>'),d.push('<input type="checkbox" name="name'),d.push(e.id||e.label),d.push('" id="id'),d.push(e.id||e.label),d.push(e.skip?'"':'" checked'),d.push("><span>"),d.push(e.label),d.push("</span></label>");d.push('<button class="btn btn-small toggle-all hide js-toggle-checked"><span class="icon-eye-close"></span> <b>Скрыть все</b></button>'),d.push("</div>"),b.html(d.join(""))}(),a.$el.bind("plothover",_.throttle(f,50)),a.$el.bind("plotselected",App.applyOnPlots.bind(App,"setZoom")),!1!==a.addLegend&&a.$el.find(".js-toggle-checked").removeClass("hide").on("click",h),a.$el.on("dblclick",App.applyOnPlots.bind(App,"setZoom")),a.$el.on("click","input",function(){c()}),i.setZoom=d,i.doResize=function(){i.resize(),i.setupGrid(),i.draw(),i.clearCrosshair()};var k,l=a.$el.find(".btn-group").removeClass("hide"),m=[];2===a.pType?(k=["avg","perc50","perc80","perc95","perc99","perc100","min","max","lossy"],i.plotAccordingToChoices=c):1!==a.pType&&3!==a.pType||(k=["rate","count"]),l.find(".js-selected").text(a.currentType),$.each(k,function(b,c){m.push("<li"+(c===a.currentType?' class="active"':"")+'><a tabindex="-1" href="#">'+c+"</a></li>")}),l.find("ul").append(m.join("")),l.on("click","a",function(){var b=$(this).text();l.find(".js-selected").text(b),a.currentType=b,c(),1!==a.pType||"count"!==b&&"rate"!==b||a.$el.find(".plotlegend #idrate").parent().find("span:last-child").text(b)}),App._registerPlot(a)}},App.showPlotTooltip=function(a,b,c){var d=App._plotAxisTooltip;if(d||(d=App._plotAxisTooltip=$("<div></div>").css({position:"absolute",display:"none",padding:"2px",outline:"1px solid rgb(195, 99, 99)",margin:"4px 0 0 2px","white-space":"nowrap","background-color":"white"}).appendTo("body")),c){var e=a.p2c({x:c});d.html($.plot.formatDate(new Date(c),"%d.%m.%Y %H:%M:%S")).show().css({top:a.offset().top+a.height(),left:Math.min(a.offset().left+e.left-d.width()/2,$(window).width()-d.width()-30)})}else d.hide();var f=App._plotTooltip;f||(f=App._plotTooltip=$("<div><b style='display: inline-block; width: 20px; border-radius: 10px; margin-right: 5px;'>&nbsp;</b><span></span></div>").css({position:"absolute",display:"none",padding:"2px","white-space":"nowrap","background-color":"white"}).appendTo("body")),b?f.find("b").css({"background-color":b.series.color}).end().find("span").html(b.series.label+" = "+b.datapoint[1]).end().show().css({top:b.pageY-30,left:Math.min(b.pageX+5,$(window).width()-f.width()-30)}):f.hide()},App.showPlot=function(a,b){App._createPlot(a),App._createPlot(b)},App.getPlotScale=function(a){switch(+(a=a||App.scale)){case 21600:return 86400;case 3600:return 3600;case 60:return 60;case 5:return 5;default:return a}},App.getPlotAxisValueTime=function(a){if(a>=1e9){var b=a.toFixed(1).toString().length-1;return(a/Number("1e"+b)).toFixed(1)+"e"+b+" s"}return a>=1e6?(a/1e6).toFixed(0)+" s":a>=1e3?(a/1e3).toFixed(0)+" ms":a>=10?a.toFixed(0)+" μs":a>0?a.toFixed(2)+" μs":""},App.getPlotAxisValueCount=function(a){if(a>=1e9){var b=a.toFixed(1).toString().length-1;return(a/Number("1e"+b)).toFixed(1)+"e"+b}return a>=1e6?(a/1e6).toFixed(1)+"M":a>=1e3?(a/1e3).toFixed(1)+"k":a>10?a.toFixed(0):a>0?a.toFixed(2):""},App.getPlotOptions=function(a){var b={colors:"#FF0000,#00FF00,#0000FF,#FF00FF,#00FFFF,#000000,#70DB93,#B5A642,#5F9F9F,#B87333,#2F4F2F,#9932CD,#FFFF00,#871F78,#855E42,#545454,#8E2323,#F5CCB0,#238E23,#CD7F32,#DBDB70,#C0C0C0,#527F76,#9F9F5F,#8E236B,#2F2F4F,#EBC79E,#CFB53B,#FF7F00,#DB70DB,#D9D9F3,#5959AB,#8C1717,#238E68,#6B4226,#8E6B23,#007FFF,#00FF7F,#236B8E,#38B0DE,#DB9370,#ADEAEA,#5C4033,#4F2F4F,#CC3299,#99CC32".split(","),series:{shadowSize:null,lines:{show:!0,lineWidth:1},points:{symbol:function(a,b,c){a.strokeStyle=$.color.parse(a.strokeStyle).add("rg",-50).add("a",1).toString(),a.arc(b,c,2,0,2*Math.PI,!1)}}},legend:{show:!1,margin:[-250,0]},xaxis:{mode:"time",max:Date.now(),min:Date.now()-1e3*App.getPlotScale()*App.PLOT_HISTORY,minTickSize:[App.getPlotScale(),"second"],labelWidth:40},yaxis:{labelWidth:40},grid:{hoverable:!0,borderWidth:0},crosshair:{mode:"x"},selection:{mode:"x"},hooks:{drawSeries:[function(a,b,c){var d,e,f,g,h=c.xaxis,i=c.yaxis,j=a.getPlotOffset(),k=c.datapoints.points,l=c.datapoints.pointsize;b.save(),b.translate(j.left,j.top);for(var m=0;m<k.length;m+=l)d=k[m],g=k[m+1],null==d||d<h.min||d>h.max||g<i.min||g>i.max||(e=k[m-l],f=k[m+l],null==e&&null==f&&(b.beginPath(),d=h.p2c(d),g=i.p2c(g),b.lineWidth=2,b.strokeStyle=c.color,b.arc(d,g,1,0,2*Math.PI),b.closePath(),b.stroke()));b.restore()}]}};switch(a){case 1:b.yaxes=[{tickFormatter:App.getPlotAxisValueTime},{min:0,alignTicksWithAxis:1,position:"right",tickFormatter:App.getPlotAxisValueCount}];break;case 2:b.yaxes=[{tickFormatter:App.getPlotAxisValueTime}],b.hooks.processOffset=[function(a,b){b.right=50}];break;case 3:b.yaxes=[{min:0,position:"right",tickFormatter:App.getPlotAxisValueCount}],b.hooks.processOffset=[function(a,b){b.left=50,b.right=5}]}return b},App._checkPlotData=function(a,b,c,d){d&&(b-d)/1e3>App.getPlotScale()&&a.push([b,null]),a.push([b,c])},App.getPlotDataSingle=function(a){var b,c,d=a.scale/1e6||App.getPlotScale();return _.reduce(a.counters,function(a,e,f,g){return b=e[0]/1e3,c=f&&g[f-1][0]/1e3,App._checkPlotData(a[0].data,b,e[1],c),App._checkPlotData(a[1].data,b,e[3],c),App._checkPlotData(a[2].data,b,e[4],c),App._checkPlotData(a[3].data,b,e[5],c),App._checkPlotData(a[4].data,b,e[6],c),App._checkPlotData(a[5].data,b,e[7],c),App._checkPlotData(a[6].data,b,e[2],c),App._checkPlotData(a[7].data,b,(e[2]/d).toFixed(2),c),App._checkPlotData(a[8].data,b,e[8],c),App._checkPlotData(a[9].data,b,e[9],c),App._checkPlotData(a[10].data,b,e[10],c),a},[{label:"avg",color:"#0000a0",data:[]},{label:"perc50",color:"#800000",data:[]},{label:"perc80",color:"#e00000",data:[]},{label:"perc95",color:"#ff8080",data:[]},{label:"perc99",color:"#ffb0b0",data:[]},{label:"perc100",color:"#ffb757",data:[],skip:!0},{label:"count",color:"#00a000",data:[],yaxis:2},{label:"rate",color:"#00a000",data:[],yaxis:2},{label:"min",color:"#ff0000",data:[],skip:!0},{label:"max",color:"#5f9f9f",data:[],skip:!0},{label:"lossy",color:"#9932cd",data:[],skip:!0}])},App.getOldPlotTS=function(a){return+_.max(_.keys(a),function(a){return+a})||0},App.getOldPlotData=function(a,b){return _.reduce(a,function(a,c){return a[c[0]/1e3]={ts:c[0]/1e3,avg:c[1],count:c[2],rate:Math.round(c[2]/b),perc50:c[3],perc80:c[4],perc95:c[5],perc99:c[6],perc100:c[7],min:c[8],max:c[9],lossy:c[10]},a},{})},App.getPlotData=function(a,b){var c=0,d=a.scale/1e6||App.getPlotScale();return _.reduce(a,function(a,e){for(var f,g,h,i=e.name.split("~~"),j=null!=b?i[b]:_.last(i),k={label:j,id:"-plbl-"+c++,data:{avg:[],perc50:[],perc80:[],perc95:[],perc99:[],perc100:[],min:[],max:[],lossy:[]}},l={label:j,id:"-plbl-"+c++,data:{count:[],rate:[]}},m=0;m<e.counters.length;++m)f=e.counters[m],g=f[0]/1e3,h=m&&e.counters[m-1][0]/1e3,App._checkPlotData(k.data.avg,g,f[1],h),App._checkPlotData(l.data.rate,g,Math.round(f[2]/d),h),App._checkPlotData(l.data.count,g,f[2],h),App._checkPlotData(k.data.perc50,g,f[3],h),App._checkPlotData(k.data.perc80,g,f[4],h),App._checkPlotData(k.data.perc95,g,f[5],h),App._checkPlotData(k.data.perc99,g,f[6],h),App._checkPlotData(k.data.perc100,g,f[7],h),App._checkPlotData(k.data.min,g,f[8],h),App._checkPlotData(k.data.max,g,f[9],h),App._checkPlotData(k.data.lossy,g,f[10],h);return a[0].push(k),a[1].push(l),a},[[],[]])},$(function(){window.location.hash=window.location.hash.replace(/(%3C([^]+)%3E)/gi,""),btp.show("serverlist",{data:App.hostConfig.cluster.types},"#serverlist"),window.btp.cluster=App.hostConfig.cluster.default,App._cacheAlive=App.hostConfig.cacheTTL||1/0,App.scale=5;var a=document.cookie.match(/JCB\{(.+)\}JCE/);if(null!=a){var b=getJsonFromUrl(a[1]);void 0!==b.scale&&(App.scale=1*b.scale),void 0!==b.cluster&&(window.btp.cluster=b.cluster)}App.set(window.btp.cluster,"HostGroup"),App.set(App.scale,"Scale");var c="flot";btp.isLocalStorageAvailable()&&(c=localStorage.Graph||c),App.set(c,"Graph"),new App.Controllers,btp.show("layout",{},"#content"),$(document).on("click",".js-selector ul a",function(a){App.Updaters.reset();var b=$(this).closest(".js-selector").data("type"),c=$(this).data("value");return App.set(c,b),Backbone.history.loadUrl(),!0}).on("click",".js-mainmenu",function(a){var b=$(this);return $(".js-mainmenu").removeClass("active"),b.addClass("active"),!0}).on("click","ul.dropdown-menu li a",function(a){a.preventDefault();var b=$(this).parent();b.siblings(".active").removeClass("active"),b.addClass("active")}).on("click","ul li a.js-reload",function(a){a.preventDefault(),App.Updaters.reset(),Backbone.history.loadUrl()}).on("keydown",".form-search input",_.debounce(function(){var a=$(this).val().toLocaleLowerCase();App.Updaters.update_left_selection(a,1)},300)).on("submit",".form-search",function(a){a.preventDefault()}).on("click","ul li a.js-errors",function(a){a.preventDefault();var b=$("#errorList");b.modal("show").one("hide",function(){$("ul li a.js-errors").parent().addClass("empty").end().find("b").text("0"),b.find(".alert.msg-container-top").addClass("viewed")})}).on("click","ul li a.js-reset-list",function(a){a.preventDefault(),window.btp.clearCache(),App.Updaters.reset(),Backbone.history.loadUrl()}),$("#content-left").on("click",function(a){var b=$(a.target),c=b.closest(".item"),d=b.closest(".js-parent");if(!c.length&&d.length){if(a.preventDefault(),!d.hasClass("show")){var e=btp.dataList&&btp.dataList[d.index()];if(e&&e.items){for(var f=0;f<e.items.length;f++)e.items[f].val.match(/(<[\s\S]*(.*?)>)/gi)&&(e.items[f].val=e.items[f].val.replace(/(<[\s\S]*(.*?)>)/gi,"")),e.items[f].name.match(/(<[\s\S]*(.*?)>)/gi)&&(e.items[f].name=e.items[f].name.replace(/(<[\s\S]*(.*?)>)/gi,""));btp.show("left_list",{r:e.items,link:curry(getLink,btp.dataType)},d.find(".items"))}d.data("active",1)}d.toggleClass("show")}}),function(a){"use strict";var b=a("#js-chunks-loader"),c=b.outerWidth();a(document).on("loader.progress",function(a,d){var e=d.progress||0;e>1&&(e/=100),e>1&&(e=0),b.show().css("width",c*e)}),a(document).on("loader.finished",function(a,c){b.hide().css("width","")})}($),$(window).on("resize",_.debounce(function(){App.current_width=$(window).width()-400},50)).trigger("resize"),Backbone.history.start()});